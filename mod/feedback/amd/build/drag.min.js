define(["jquery","core/ajax","core/templates"],function(a,b,c){return{init:function(d){var e={DRAGAREA:"#feedback_dragarea",DRAGITEMCLASS:"feedback_itemlist",DRAGITEM:"div.feedback_itemlist",DRAGLIST:"#feedback_dragarea form",DRAGHANDLE:"itemhandle"},f=null,g=0,h=function(a,c,d){d.show();var e=b.call([{methodname:"mod_feedback_update_questions_order",args:{cmid:a,itemorder:c}}]);e[0].done(function(){d.hide()}).fail(function(){d.hide()})},i=function(a){return Number(a.replace(/^.*feedback_item_/i,""))},j=function(b,d){var e=a("<span></span>");return e.addClass(b),e.attr("title",d),e.attr("tabIndex",0),e.attr("role","button"),e.attr("draggable",!0),c.renderPix("i/move_2d","core").then(function(a){return e.append(a),!0}).fail(),e.on(),e},k=a(e.DRAGITEM);k.each(function(){a(this).attr("id","mod_feedback"+g++);var b=M.util.get_string("move_item","feedback"),c=j(e.DRAGHANDLE,b);a(this).append(c);var k=function(b){a(e.DRAGITEM).find("div").css("pointer-events",b)},l=function(b){if(b!==f){var c=a("#"+b),d=a("#"+f),e=c.html();c.html(d.html()),d.html(e),f=b}};a(this).attr("draggable",!0),a(this).on("dragstart",function(){k("none"),f=a(this).attr("id")}),a(this).on("dragover",function(a){return a.preventDefault(),!1}),a(this).on("dragenter",function(){a(this).addClass("drag_item_active"),l(a(this).attr("id"))}),a(this).on("dragleave",function(){a(this).removeClass("drag_item_active")}),a(this).on("drop",function(){a(this).removeClass("drag_item_active"),k("auto");var b=[];a('.felement [id^="feedback_item_"]').each(function(){b.push(i(a(this).attr("id")))});var c=a("<img>").attr("src",M.util.image_url("i/loading_small","moodle"));a(this).append(c),h(d,b.toString(),c)})})}}});